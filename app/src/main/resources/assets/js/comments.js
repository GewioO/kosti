function initComments(){0<$(".js_article-comments").length&&($(".js_article-comments").on("click",".js_answer-comment",function(e){$("form[data-parentid="+$(this).data("id")+"]").toggleClass("hidden")}),$(".js_article-comments").on("submit",".js_comment-form",function(e){if(e.preventDefault(),checkUserLoggedIn()){var t={};$.each($(this).serializeArray(),function(){t[this.name]=this.value}),addComment(this,t)}else showLogin(e)}),$(".js_remove_comment-form").on("submit",function(e){if(e.preventDefault(),checkUserLoggedIn()){var t={};$.each($(this).serializeArray(),function(){t[this.name]=this.value}),removeComment(t)}else showLogin(e)}),$(".js_article-comments").on("click",".js_comment-like",function(e){e.preventDefault(),checkUserLoggedIn()?likeComment(this):showLogin(e)}),$(".js_article-comments").on("click",".js_comment-remove_btn",function(e){checkUserLoggedIn()?showRemoveFunction(this,e):showLogin(e)}))}function likeComment(t){var e={action:"vote",id:$(t).data("id")};makeAjaxCall(commentsServiceUrl,"POST",e,!0).done(function(e){$(t).text(e.rate),e.voted?$(t).addClass("active"):$(t).removeClass("active")})}function addComment(e,t){var n=$(e).data("parentid")?$(e).data("parentid"):$(".js_article-id").data("articleid"),a={body:t.body,parent:n,action:"addComment"};makeAjaxCall(commentsServiceUrl,"POST",a,!0).done(function(e){n!=$(".js_article-id").data("articleid")&&$("form[data-parentid="+n+"]").addClass("hidden"),n!=$(".js_article-id").data("articleid")||$("ul.js_comments-list[data-parentid="+n+"]").length?$("ul.js_comments-list[data-parentid="+n+"]").length||$("li.js_comment[data-id="+n+"]").append('<ul class="comments-list js_comments-list" data-parentid="'+n+'"></ul>'):$(".js_article-comments").append('<ul class="comments-list js_comments-list" data-parentid="'+n+'"></ul>'),$("ul.js_comments-list[data-parentid="+n+"]").append(e),$("form[data-parentid="+n+"] textarea").val("");var t=$(".js_comment_scroll").offset().top-window.innerHeight/2;$("html, body").scrollTop(t),$(".js_comment").removeClass("js_comment_scroll")})}function showRemoveFunction(e,t){t.stopPropagation(),$(".modal-remove_comment").addClass("show"),$("input.js_comment-remove-id").val($(e).data("id"))}function removeComment(t){var e={action:"remove",id:t.id,reason:t.reason};makeAjaxCall(commentsServiceUrl,"POST",e,!0).done(function(e){$("input.js_comment-remove-id").val(""),e&&($("li[data-id="+t.id+"] > .comments-body").addClass("deleted").text("Комментарий удален"),$(".modal-remove_comment").removeClass("show"),$(el).remove())})}$(document).ready(function(){initComments()});