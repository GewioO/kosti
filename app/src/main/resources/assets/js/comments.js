function initComments(){0<$(".comments").length&&($(".comments").on("click",".js_answer-comment",function(t){$("form[data-parentid="+$(this).data("id")+"]").toggleClass("hidden")}),$(".comments").on("submit",".js_comment-form",function(t){if(t.preventDefault(),checkUserLoggedIn()){var e={};$.each($(this).serializeArray(),function(){e[this.name]=this.value}),addComment(this,e)}else showLogin(t)}),$(".comments").on("click",".js_comment-like",function(t){t.preventDefault(),checkUserLoggedIn()?likeComment(this):showLogin(t)}),$(".comments").on("click",".js_comment-remove_btn",function(t){checkUserLoggedIn()?removeComment(this):showLogin(t)}))}function likeComment(e){var t={action:"vote",id:$(e).data("id")};makeAjaxCall(commentsServiceUrl,"POST",t,!0).done(function(t){$(e).text(t.rate),t.voted?$(e).addClass("active"):$(e).removeClass("active")})}function addComment(t,e){var a=$(t).data("parentid")?$(t).data("parentid"):$(".js_article-id").data("articleid"),n={body:e.body,parent:a,action:"addComment"};makeAjaxCall(commentsServiceUrl,"POST",n,!0).done(function(t){a!=$(".js_article-id").data("articleid")&&$("form[data-parentid="+a+"]").addClass("hidden"),a!=$(".js_article-id").data("articleid")||$("ul.js_comments-list[data-parentid="+a+"]").length?$("ul.js_comments-list[data-parentid="+a+"]").length||$("li.js_comment[data-id="+a+"]").append('<ul class="comments-list js_comments-list" data-parentid="'+a+'"></ul>'):$(".js_article-comments").append('<ul class="comments-list js_comments-list" data-parentid="'+a+'"></ul>'),$("ul.js_comments-list[data-parentid="+a+"]").append(t),$("form[data-parentid="+a+"] textarea").val("")})}function removeComment(e){var t={action:"remove",id:$(e).data("id")};makeAjaxCall(commentsServiceUrl,"POST",t,!0).done(function(t){t&&$("li[data-id="+$(e).data("id")+"] > .comments-body").text("Комментарий удален")})}$(document).ready(function(){initComments()});